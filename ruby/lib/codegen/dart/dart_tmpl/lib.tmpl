library #{@lib.name};

<?rb @lib.imports.each do |imp| ?>
import "#{imp}";
<?rb end ?>
<?rb @lib.parts.each do |part| ?>
part "src/#{@lib.name}/#{part.id}.dart";
<?rb end ?>
<?rb if not @lib.public_constants.empty? ?>

<?rb @lib.public_constants.each do |t,n,val| ?>
const #{t} #{n} = #{val};
<?rb end ?>
<?rb end ?>
<?rb if not @lib.generated.empty? ?>

#{@lib.generated.join(Codegen::NL)}
<?rb end ?>

main() { 
  print("Main for lib #{@lib.id}");
<?rb if not @lib.generated_main.empty? ?>

#{@lib.generated_main.join(Codegen::NL)}
<?rb end ?>
#{Codegen.protect_block("#{@lib.id} main")}
}

#{Codegen.protect_block("#{@lib.id} top level")}
